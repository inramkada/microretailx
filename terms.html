<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SYSTEM UPGRADE | MICRORETAILX</title>
  <style>
    :root {
      --accent: #00f2ff;
      --bg: #000;
    }
    html, body {
      margin: 0; padding: 0; height: 100%;
      background: var(--bg); overflow: hidden;
      color: #fff; font-family: "JetBrains Mono", "Fira Code", monospace;
    }
    canvas { display:block; width:100vw; height:100vh; filter: contrast(1.15) brightness(1.08); }

    .ui-layer { position: fixed; inset: 0; pointer-events: none; z-index: 10; }

    .top-bar {
      position: absolute; top: 0; left: 0; right: 0;
      padding: 20px 30px;
      display: flex; justify-content: space-between;
      background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
      border-top: 2px solid var(--accent);
    }

    .brand {
      font-size: 10px; letter-spacing: 6px; font-weight: 900;
      text-transform: uppercase; color: var(--accent);
      text-shadow: 0 0 10px rgba(0, 242, 255, 0.5);
    }

    .status-tag {
      font-size: 9px; color: rgba(255,255,255,0.5);
      display: flex; align-items: center; gap: 8px;
    }
    .dot { width: 6px; height: 6px; background: var(--accent); border-radius: 50%; animation: pulse 1.5s infinite; }

    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

    .footer-bar {
      position: absolute; bottom: 0; left: 0; right: 0;
      padding: 20px 30px;
      background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
      pointer-events: auto;
    }

    .footer-links { display: flex; gap: 25px; font-size: 10px; letter-spacing: 2px; margin-bottom: 10px; }
    .footer-links a { color: rgba(255,255,255,0.6); text-decoration: none; transition: 0.3s; pointer-events: auto; }
    .footer-links a:hover { color: var(--accent); }

    .copyright { font-size: 8px; opacity: 0.3; letter-spacing: 1px; }
  </style>
</head>
<body>

  <canvas id="view"></canvas>

  <div class="ui-layer">
    <div class="top-bar">
      <div class="brand">Protocol: Maintenance</div>
      <div class="status-tag"><span class="dot"></span> System Live</div>
    </div>

    <div class="footer-bar">
      <div class="footer-links">
        <a href="#">ACCESS_CORE</a>
        <a href="#">ENCRYPT_KEY</a>
        <a href="#">TERMINAL</a>
      </div>
      <div class="copyright">© 2026 MICRORETAILX LLC // REPLICANT_ENGINE_V2</div>
    </div>
  </div>

  <script>
    (() => {
      "use strict";
      const view = document.getElementById("view");
      const vctx = view.getContext("2d", { alpha: false });
      const simCanvas = document.createElement("canvas");
      const sctx = simCanvas.getContext("2d", { willReadFrequently: true });

      const IS_MOBILE = /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);

      let W, H, simW, simH, dpr;
      let trailA, trailB, imgData, img8;
      let agents = [];
      let frame = 0;

      const CFG = {
        agentCount: IS_MOBILE ? 8000 : 15000,
        step: IS_MOBILE ? 0.85 : 1.1,
        sensorDist: IS_MOBILE ? 8.5 : 11.0,
        sensorAngle: 0.58,
        turnSpeed: 0.38,
        deposit: 0.85,
        decay: IS_MOBILE ? 0.965 : 0.972,
        diffuseEvery: 2,
        diffuseMix: 0.48
      };

      function resize() {
        dpr = Math.min(2, window.devicePixelRatio || 1);
        W = window.innerWidth;
        H = window.innerHeight;
        view.width = W * dpr;
        view.height = H * dpr;
        view.style.width = W + "px";
        view.style.height = H + "px";
        vctx.setTransform(dpr, 0, 0, dpr, 0, 0);

        const maxSide = IS_MOBILE ? 520 : 750;
        const aspect = W / Math.max(1, H);
        if (W >= H) {
          simW = maxSide;
          simH = Math.max(160, (maxSide / aspect) | 0);
        } else {
          simH = maxSide;
          simW = Math.max(160, (maxSide * aspect) | 0);
        }

        simCanvas.width = simW;
        simCanvas.height = simH;

        const n = simW * simH;
        trailA = new Float32Array(n).fill(0);
        trailB = new Float32Array(n).fill(0);

        imgData = sctx.createImageData(simW, simH);
        img8 = imgData.data;

        seed();
      }

      function seed() {
        agents = [];
        for (let i = 0; i < CFG.agentCount; i++) {
          agents.push({
            x: Math.random() * simW,
            y: Math.random() * simH,
            a: Math.random() * Math.PI * 2
          });
        }
      }

      function idx(x, y) {
        return x + y * simW;
      }

      function sample(f, x, y) {
        const xi = x | 0, yi = y | 0;
        if (xi < 0 || yi < 0 || xi >= simW || yi >= simH) return 0;
        return f[idx(xi, yi)];
      }

      function deposit(f, x, y, amt) {
        const xi = x | 0, yi = y | 0;
        if (xi < 0 || yi < 0 || xi >= simW || yi >= simH) return;
        const k = idx(xi, yi);
        f[k] = Math.min(1.0, f[k] + amt);
      }

      function diffuse(src, dst, mix) {
        const w = simW, h = simH;
        for (let y = 1; y < h - 1; y++) {
          const row = y * w;
          for (let x = 1; x < w - 1; x++) {
            const k = row + x;
            const v =
              src[k] +
              src[k - 1] + src[k + 1] +
              src[k - w] + src[k + w] +
              src[k - w - 1] + src[k - w + 1] +
              src[k + w - 1] + src[k + w + 1];
            const blur = v / 9;
            dst[k] = src[k] * (1 - mix) + blur * mix;
          }
        }
        // Bordes
        for (let x = 0; x < w; x++) {
          dst[x] = src[x];
          dst[x + (h - 1) * w] = src[x + (h - 1) * w];
        }
        for (let y = 0; y < h; y++) {
          dst[y * w] = src[y * w];
          dst[(w - 1) + y * w] = src[(w - 1) + y * w];
        }
      }

      function step() {
        const stepDist = CFG.step;
        const sDist = CFG.sensorDist;
        const sAng = CFG.sensorAngle;
        const turn = CFG.turnSpeed;

        for (let i = 0; i < agents.length; i++) {
          const p = agents[i];

          const ca = Math.cos(p.a), sa = Math.sin(p.a);
          const fx = p.x + ca * sDist, fy = p.y + sa * sDist;
          const lx = p.x + Math.cos(p.a - sAng) * sDist, ly = p.y + Math.sin(p.a - sAng) * sDist;
          const rx = p.x + Math.cos(p.a + sAng) * sDist, ry = p.y + Math.sin(p.a + sAng) * sDist;

          const fF = sample(trailA, fx, fy);
          const fL = sample(trailA, lx, ly);
          const fR = sample(trailA, rx, ry);

          if (fF > fL && fF > fR) {
            // Mantener dirección
          } else if (fL > fR) {
            p.a -= turn;
          } else if (fR > fL) {
            p.a += turn;
          } else {
            p.a += (Math.random() - 0.5) * 0.18;
          }

          p.x += Math.cos(p.a) * stepDist;
          p.y += Math.sin(p.a) * stepDist;

          // Wrapping toroidal
          if (p.x < 0) p.x += simW;
          else if (p.x >= simW) p.x -= simW;
          if (p.y < 0) p.y += simH;
          else if (p.y >= simH) p.y -= simH;

          deposit(trailA, p.x, p.y, CFG.deposit);
        }

        // Decay
        const d = CFG.decay;
        for (let k = 0; k < trailA.length; k++) trailA[k] *= d;

        // Diffusion
        if ((frame % CFG.diffuseEvery) === 0) {
          diffuse(trailA, trailB, CFG.diffuseMix);
          const tmp = trailA;
          trailA = trailB;
          trailB = tmp;
        }

        frame++;
      }

      function draw() {
        const n = simW * simH;
        for (let k = 0, p = 0; k < n; k++, p += 4) {
          const t = trailA[k];
          const v = t <= 0 ? 0 : Math.pow(Math.min(t, 1), 0.68);

          // Cyan tech agresivo
          const r = Math.min(255, (12 + v * 95) | 0);
          const g = Math.min(255, (45 + v * 240) | 0);
          const b = Math.min(255, (65 + v * 255) | 0);

          img8[p] = r;
          img8[p + 1] = g;
          img8[p + 2] = b;
          img8[p + 3] = 255;
        }

        sctx.putImageData(imgData, 0, 0);

        vctx.imageSmoothingEnabled = true;
        vctx.fillStyle = "#000";
        vctx.fillRect(0, 0, W, H);
        vctx.drawImage(simCanvas, 0, 0, simW, simH, 0, 0, W, H);
      }

      function loop() {
        step();
        draw();
        requestAnimationFrame(loop);
      }

      window.addEventListener("resize", resize);
      window.addEventListener("keydown", (e) => {
        if (e.key === "r" || e.key === "R") seed();
      });

      resize();
      loop();
    })();
  </script>
</body>
</html>
