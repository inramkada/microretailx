<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UNDER MAINTENANCE</title>

  <meta name="referrer" content="no-referrer">
  <meta http-equiv="Permissions-Policy"
        content="geolocation=(), microphone=(), camera=(), payment=(), usb=()">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      overflow: hidden;
      color: #fff;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
                   "Liberation Mono", "Courier New", monospace;
    }
    canvas { display:block; width:100vw; height:100vh; }

    .ui-layer { position: fixed; inset: 0; pointer-events: none; z-index: 10; }

    .top-bar {
      position: absolute; top: 0; left: 0; right: 0;
      padding: 14px 18px;
      display: flex; justify-content: flex-start;
      background: rgba(0,0,0,0.78);
      border-bottom: 1px solid rgba(255,255,255,0.10);
      backdrop-filter: blur(10px);
    }

    .brand {
      font-size: 12px;
      letter-spacing: 4px;
      font-weight: 900;
      opacity: 0.92;
      color: rgba(255,255,255,0.92);
      mix-blend-mode: difference;
    }

    .footer-bar {
      position: absolute; bottom: 0; left: 0; right: 0;
      padding: 14px 18px 12px;
      display: flex; flex-direction: column; align-items: center;
      gap: 8px;
      background: rgba(0,0,0,0.78);
      border-top: 1px solid rgba(255,255,255,0.10);
      backdrop-filter: blur(10px);
      pointer-events: auto;
    }

    .copyright {
      font-size: 9px;
      letter-spacing: 1px;
      opacity: 0.45;
      text-align: center;
    }

    .brand-link,
    .brand-link:visited,
    .brand-link:hover,
    .brand-link:active,
    .brand-link:focus {
      color: inherit;
      text-decoration: none;
      outline: none;
    }
  </style>
</head>

<body>
<canvas id="view"></canvas>

<div class="ui-layer">
  <div class="top-bar">
    <div class="brand">UNDER MAINTENANCE</div>
  </div>

  <footer class="footer-bar">
    <div class="copyright">
      © 2023–2026
      <a class="brand-link" href="https://www.microretailx.com">MICRORETAILX</a>
      LLC — ALL RIGHTS RESERVED
    </div>
  </footer>
</div>

<script>
(() => {
  "use strict";

  const view = document.getElementById("view");
  const vctx = view.getContext("2d", { alpha: false });

  const simCanvas = document.createElement("canvas");
  const sctx = simCanvas.getContext("2d", { willReadFrequently: true });

  const UA = navigator.userAgent || "";
  const IS_IOS =
    /iPhone|iPad|iPod/i.test(UA) ||
    (navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1);
  const IS_MOBILE = /Mobi|Android|iPhone|iPad/i.test(UA);

  const clamp = (v,a,b)=> Math.max(a, Math.min(b, v));
  const lerp  = (a,b,t)=> a + (b-a)*t;
  const ease  = t => t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t + 2, 3)/2;
  const easeInOut = t => t < 0.5 ? 2*t*t : 1 - Math.pow(-2*t + 2, 2)/2;

  const DPR_CAP = IS_IOS ? 1.6 : 2;
  let dpr = Math.min(DPR_CAP, window.devicePixelRatio || 1);

  let W=0, H=0;
  let simW=0, simH=0;

  let trailA, trailB;
  let xField;
  let imgData, img8;
  let agents = [];
  let foods = [];
  let tPrev = performance.now();
  let frame = 0;

  const INTRO = {
    start: performance.now(),
    durIn: 1800,
    durFlash: 320,
    durOut: 900,
    get active() {
      const t = performance.now() - this.start;
      return t < (this.durIn + this.durFlash + this.durOut);
    }
  };

  const CFG = {
    gridMax: IS_MOBILE ? 540 : 820,
    agentCount: IS_MOBILE ? 6000 : 12000,
    step: IS_MOBILE ? 0.9 : 1.05,
    sensorDist: IS_MOBILE ? 6.2 : 7.8,
    sensorAngle: 0.55,
    turnSpeed: 0.34,
    deposit: 0.94,
    decay: IS_MOBILE ? 0.973 : 0.979,
    diffuseEvery: 2,
    diffuseMix: 0.42,
    xBias: 0.82,
    xWidthPx: IS_MOBILE ? 3.6 : 4.6,
    foodRadius: IS_MOBILE ? 18 : 22,
    foodStrength: 1.55,
    foodLifeMs: 1300,
    mouseFoodEveryMs: IS_MOBILE ? 42 : 28,
    xInk: 0.42,
    crush: 0.03
  };

  function resize() {
    dpr = Math.min(DPR_CAP, window.devicePixelRatio || 1);
    W = window.innerWidth | 0;
    H = window.innerHeight | 0;

    view.width = (W * dpr) | 0;
    view.height = (H * dpr) | 0;
    view.style.width = W + "px";
    view.style.height = H + "px";
    vctx.setTransform(dpr,0,0,dpr,0,0);

    const maxSide = CFG.gridMax;
    const aspect = W / Math.max(1, H);
    if (W >= H) {
      simW = maxSide;
      simH = Math.max(160, (maxSide / aspect) | 0);
    } else {
      simH = maxSide;
      simW = Math.max(160, (maxSide * aspect) | 0);
    }

    simCanvas.width = simW;
    simCanvas.height = simH;

    const n = simW * simH;
    trailA = new Float32Array(n);
    trailB = new Float32Array(n);
    xField = new Float32Array(n);

    imgData = sctx.createImageData(simW, simH);
    img8 = imgData.data;

    buildXField();
    seedAgents(true);
    inkXLine(CFG.xInk);
  }

  window.addEventListener("resize", resize);

  function idx(x,y){ return x + y * simW; }

  function buildXField() {
    const w=simW, h=simH;
    const a=(h-1)/Math.max(1,(w-1));
    const inv=1/Math.sqrt(1+a*a);
    const sigma=CFG.xWidthPx;
    const sigma2=sigma*sigma;

    for(let y=0;y<h;y++){
      for(let x=0;x<w;x++){
        const d1=Math.abs(a*x-y)*inv;
        const d2=Math.abs(a*x+y-(h-1))*inv;
        const d=Math.min(d1,d2);
        xField[idx(x,y)] = Math.exp(-(d*d)/(2*sigma2));
      }
    }
  }

  function seedAgents(reset=false){
    if(reset){ trailA.fill(0); trailB.fill(0); }
    agents.length=0;
    for(let i=0;i<CFG.agentCount;i++){
      let x=Math.random()*simW;
      let y=Math.random()*simH;
      agents.push({x,y,a:Math.random()*Math.PI*2});
    }
  }

  function inkXLine(a){
    for(let i=0;i<trailA.length;i++){
      if(xField[i]>0.18) trailA[i]=Math.max(trailA[i],a*xField[i]);
    }
  }

  function stepSim(dt){
    for(const p of agents){
      p.x+=Math.cos(p.a)*CFG.step;
      p.y+=Math.sin(p.a)*CFG.step;
      if(p.x<0)p.x+=simW;if(p.x>=simW)p.x-=simW;
      if(p.y<0)p.y+=simH;if(p.y>=simH)p.y-=simH;
      trailA[idx(p.x|0,p.y|0)] = 1;
    }
    for(let i=0;i<trailA.length;i++) trailA[i]*=CFG.decay;
  }

  function render(){
    for(let i=0,p=0;i<trailA.length;i++,p+=4){
      const v=trailA[i];
      img8[p]=8+v*80;
      img8[p+1]=35+v*200;
      img8[p+2]=55+v*220;
      img8[p+3]=255;
    }
    sctx.putImageData(imgData,0,0);
    vctx.drawImage(simCanvas,0,0,W,H);
  }

  function loop(now){
    const dt=clamp(now-tPrev,8,40);
    tPrev=now;
    stepSim(dt);
    render();
    requestAnimationFrame(loop);
  }

  resize();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
