<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Consent Smoke Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    html, body { margin:0; padding:0; height:100%; background:#000; color:#fff; }
    canvas { position:fixed; inset:0; z-index:1; }

    html.consent-locked, body.consent-locked { overflow:hidden; }

    #consentLock{
      display:none;
      position:fixed; inset:0; z-index:99990;
      pointer-events:all;
      background:rgba(0,0,0,.7);
      backdrop-filter:blur(6px);
    }
    html.consent-locked #consentLock{ display:block; }

    #content{
      position:relative; z-index:2;
      padding:24px;
      pointer-events:auto;
    }

    html.consent-locked canvas{
      filter: grayscale(1) brightness(.7);
      opacity:.85;
      transition:filter .8s ease, opacity .8s ease;
    }
    html.consent-decided canvas{
      filter:none; opacity:1;
    }
  </style>
</head>

<body>
  <canvas id="canvas"></canvas>
  <div id="consentLock"></div>

  <div id="content">
    <h1>Contenido de prueba</h1>
    <p>Si puedes interactuar antes de decidir, algo está mal.</p>
    <button onclick="alert('NO debería poder pulsarse antes de decidir')">
      Botón de prueba
    </button>
  </div>

  <script type="module">
    import { applyInitialLock, isDecided, onDecided } from "./assets/consent/consent-core.js";
    import { maybeMountConsentUI } from "./assets/consent/consent-ui.js";
    import { init as initInicio } from "./assets/backgrounds/fondo-particulas-inicio.js";

    applyInitialLock();

    if (!isDecided()) {
      maybeMountConsentUI();
    }

    onDecided(() => {
      initInicio("canvas");
      console.log("CONSENT DECIDED → app unlocked");
    });
  </script>
</body>
</html>
