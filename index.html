<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self'; base-uri 'self'; frame-ancestors 'none'; form-action 'self'">
  <meta name="referrer" content="no-referrer">
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=(), payment=(), usb=()">
  <title>microretailX</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      overflow: hidden;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    canvas { display: block; }

    canvas { transition: filter 1.2s ease-in-out, opacity 1.2s ease-in-out; }
    body.consent-locked canvas { filter: grayscale(1) brightness(0.72) contrast(1.08); opacity: 0.85; }
    body.consent-waking canvas { filter: grayscale(0) brightness(1) contrast(1); opacity: 1; }

    .ui-layer { position: absolute; z-index: 10; color: #fff; user-select: none; }
    .top-bar {
      top: 0; right: 0; width: 100%;
      background: rgba(0,0,0,0.92);
      display: flex; justify-content: flex-end;
      padding: 12px 26px; box-sizing: border-box;
    }
    .menu { position: relative; }

    .menu-dot {
      width: 15px; height: 15px; border-radius: 50%;
      background: #fff; cursor: pointer; position: relative;
      opacity: 0.85; outline: none;
      transition: transform .25s ease, background .25s ease, box-shadow .25s ease, opacity .25s ease;
      transform: scale(1) rotate(0deg);
    }
    .menu-dot:focus-visible {
      box-shadow: 0 0 0 2px rgba(0,234,255,0.65), 0 0 14px rgba(0,234,255,0.35);
      opacity: 1;
    }
    @keyframes redPulse { 0%{box-shadow:0 0 4px #ff3333,0 0 8px #ff3333;} 100%{box-shadow:0 0 10px #ff3333,0 0 18px #ff3333;} }
    .menu-dot:hover:not(.active) { background:#ff3333; opacity:1; animation:redPulse .9s ease-in-out infinite alternate; }

    .menu-dot::before, .menu-dot::after {
      content:""; position:absolute; top:50%; left:50%;
      width:2px; height:14px; background:#00eaff;
      transform-origin:center; opacity:0; transition: opacity .25s ease;
    }
    .menu-dot::before { transform: translate(-50%,-50%) rotate(45deg); }
    .menu-dot::after  { transform: translate(-50%,-50%) rotate(-45deg); }

    @keyframes xPulseDual {
      0%{background:#00eaff; box-shadow:0 0 6px #00eaff,0 0 14px #00eaff;}
      50%{background:#ff0033; box-shadow:0 0 8px #ff0033,0 0 20px #ff0033;}
      100%{background:#00eaff; box-shadow:0 0 6px #00eaff,0 0 14px #00eaff;}
    }
    .menu-dot.active { background:transparent; box-shadow:none; opacity:1; transform:scale(1.1); }
    .menu-dot.active::before, .menu-dot.active::after { opacity:1; animation:xPulseDual 1.4s ease-in-out infinite; }

    @keyframes xShake {
      0%{transform:scale(1.1) translateX(0);}
      25%{transform:scale(1.1) translateX(-1.5px);}
      50%{transform:scale(1.1) translateX(1.5px);}
      75%{transform:scale(1.1) translateX(-1.5px);}
      100%{transform:scale(1.1) translateX(0);}
    }
    .menu-dot.active.shake { animation: xShake .22s ease-in-out; }
    .menu-dot.active.double::before, .menu-dot.active.double::after {
      box-shadow:0 0 6px #00eaff,0 0 14px #00eaff,0 0 22px rgba(255,0,80,.95);
    }

    .menu-dropdown {
      position:absolute; top:160%; right:0;
      min-width:190px; border-radius:6px; overflow:hidden;
      max-height:0; opacity:0;
      background: rgba(0,10,20,.55);
      border: 1px solid rgba(0,234,255,.33);
      backdrop-filter: blur(10px);
      box-shadow: 0 0 14px rgba(0,234,255,.27);
      transition: max-height .34s ease, opacity .25s ease;
    }
    .menu-dropdown.open { max-height:420px; opacity:1; }
    .menu-dropdown a {
      display:block; padding:10px 14px;
      font-size:15px; color:#b8faff; text-decoration:none; letter-spacing:1px;
      position:relative; cursor:pointer;
    }
    .menu-dropdown a:hover { background: rgba(0,40,60,.65); color:#fff; }
    .menu-dropdown a.locations-link { padding-left:28px; }
    .menu-dropdown a.locations-link::after {
      content:"◂"; position:absolute; left:10px; top:50%;
      transform: translateY(-50%); font-size:12px; color:#8ff3ff;
    }

    .menu-dropdown-sub {
      position:absolute; top:0; right:100%; margin-right:14px;
      min-width:220px; border-radius:6px; overflow:hidden;
      max-height:0; opacity:0;
      background: rgba(0,8,18,.95);
      border: 1px solid rgba(0,234,255,.47);
      border-left:2px solid rgba(0,234,255,.5);
      backdrop-filter: blur(12px);
      box-shadow: 0 0 22px rgba(0,234,255,.4);
      transition: max-height .3s ease, opacity .24s ease;
      padding:8px 0;
      pointer-events:none;
      z-index:30;
    }
    .menu-dropdown-sub.open { max-height:500px; opacity:1; pointer-events:auto; }
    .submenu-group { padding:4px 18px 6px 16px; }
    .submenu-label { font-size:11px; letter-spacing:1px; color:#7fd8ff; opacity:.8; margin-bottom:2px; }
    .submenu-link { display:block; font-size:13px; padding:3px 0; color:#e8ffff; text-decoration:none; }
    .submenu-link:hover { color:#fff; text-shadow:0 0 6px #00eaff; }

    .footer-bar{
      bottom:0; left:0; width:100%;
      background: rgba(0,0,0,.92);
      display:flex; flex-direction:column; align-items:center;
      padding:10px 0 8px; box-sizing:border-box;
      pointer-events:none;
    }
    .footer-links{ font-size:15px; pointer-events:auto; margin-bottom:6px; }
    .footer-links a{ color:#fff; text-decoration:none; margin:0 12px; opacity:.85; cursor:pointer; }
    .footer-links a:hover{ opacity:1; text-decoration:underline; }
    .copyright{
      font-size:9px; letter-spacing:1px; opacity:.45;
      pointer-events:auto; text-align:center; padding:0 14px; line-height:1.35;
    }

    @media (max-width: 600px){
      .menu-dot{ width:12px; height:12px; }
      .menu-dropdown a{ font-size:13px; }
      .footer-links{ font-size:13px; }
      .copyright{ font-size:8px; }
      .menu-dropdown-sub{ min-width:190px; margin-right:10px; }

      .menu-dot.active { background:transparent; box-shadow:none; opacity:1; transform:scale(1.1); }
      .menu-dot::before, .menu-dot::after{ height:12px; } /* keep proportions when dot shrinks */
      .menu-dot.active::before, .menu-dot.active::after{ opacity:1; animation:xPulseDual 1.4s ease-in-out infinite; }
      .menu-dot.active.shake{ animation:none !important; }
      .menu-dot.active.double::before, .menu-dot.active.double::after{ box-shadow:none !important; }

      .footer-links{
        text-align:center;
        padding:0 12px;
        line-height:1.9;
        margin-bottom:6px;
      }
      .footer-links a{
        display:inline-block;
        margin:4px 10px;
      }

    }

    @media (prefers-reduced-motion: reduce){
      canvas{ transition:none !important; }
      body.consent-locked .consent-banner.open{ animation:none !important; }
      .menu-dot, .menu-dot::before, .menu-dot::after{ transition:none !important; animation:none !important; }
    }

    .consent-banner{
      position:fixed; left:0; right:0; bottom:0;
      z-index:9999;
      background: rgba(0,0,0,.92);
      border-top:1px solid rgba(255,255,255,.15);
      box-shadow: 0 -10px 34px rgba(0,0,0,.65);
      backdrop-filter: blur(10px);
      padding:14px 18px; box-sizing:border-box;
      display:none;
    }
    .consent-banner.open{ display:block; }

    .consent-row{ display:flex; gap:14px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .consent-text{ color:#e8ffff; opacity:.92; font-size:13px; line-height:1.4; max-width:860px; }
    .consent-text a{ color:#fff; text-decoration:none; opacity:.95; text-shadow:0 0 10px rgba(255,255,255,.35); }
    .consent-text a:hover{ text-decoration:underline; opacity:1; }

    .consent-actions{ display:flex; gap:10px; flex-wrap:wrap; }
    .consent-btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.06);
      color:#fff;
      padding:9px 12px; border-radius:10px;
      cursor:pointer;
      font-family: inherit;
      letter-spacing:.5px; font-size:12px;
      opacity:.95;
    }
    .consent-btn:hover{ opacity:1; box-shadow:0 0 18px rgba(255,255,255,.12); }
    .consent-btn.primary{
      border-color: rgba(255,255,255,.42);
      background: rgba(255,255,255,.12);
      box-shadow:0 0 22px rgba(255,255,255,.18);
    }

    .consent-modal-backdrop{
      position:fixed; inset:0; z-index:10000;
      background: rgba(0,0,0,.74);
      display:none;
      align-items:center; justify-content:center;
      padding:18px; box-sizing:border-box;
    }
    .consent-modal-backdrop.open{ display:flex; }

    .consent-modal{
      width:min(720px,100%);
      border-radius:16px;
      background: rgba(0,8,18,.94);
      border:1px solid rgba(255,255,255,.22);
      box-shadow: 0 0 40px rgba(255,255,255,.10);
      backdrop-filter: blur(14px);
      overflow:hidden;
    }
    .consent-modal-header{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.12);
    }
    .consent-modal-title{ font-size:13px; letter-spacing:1px; color:#fff; opacity:.95; }
    .consent-modal-close{
      width:30px; height:30px; border-radius:10px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color:#fff; cursor:pointer; font-family: inherit; font-size:14px; opacity:.9;
    }
    .consent-modal-close:hover{ opacity:1; }
    .consent-modal-body{
      padding:14px 16px 8px;
      color:#e8ffff; font-size:13px; line-height:1.45; opacity:.93;
    }
    .consent-cats{ display:grid; gap:10px; margin-top:10px; }
    .consent-cat{
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between;
      padding:10px 12px;
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      background: rgba(255,255,255,.03);
    }
    .consent-cat strong{ display:block; font-size:12px; letter-spacing:.7px; color:#fff; opacity:.95; margin-bottom:4px; }
    .consent-cat p{ margin:0; font-size:12px; opacity:.86; max-width:520px; }

    .toggle{
      position:relative; width:44px; height:24px; flex:0 0 auto;
      border-radius:24px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.07);
      cursor:pointer; margin-top:2px;
    }
    .toggle::after{
      content:""; position:absolute; top:2px; left:2px;
      width:18px; height:18px; border-radius:50%;
      background: rgba(255,255,255,.92);
      transition: transform .18s ease;
    }
    .toggle.on{
      border-color: rgba(255,255,255,.35);
      background: rgba(255,255,255,.14);
      box-shadow:0 0 18px rgba(255,255,255,.10);
    }
    .toggle.on::after{ transform: translateX(20px); }
    .toggle.locked{ opacity:.6; cursor:not-allowed; }

    .consent-modal-footer{
      display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;
      padding:12px 16px 14px;
      border-top:1px solid rgba(255,255,255,.12);
    }

    body.consent-locked .ui-layer{ pointer-events:none !important; }
    body.consent-locked #consentBanner,
    body.consent-locked #consentModalBackdrop{ pointer-events:auto !important; }

    body.consent-locked .consent-banner{
      left:50%; right:auto; bottom:auto; top:50%;
      transform: translate(-50%,-50%);
      width: min(920px, calc(100% - 36px));
      border-radius:18px;
      border:1px solid rgba(255,255,255,.24);
      box-shadow: 0 0 40px rgba(255,255,255,.10), 0 0 100px rgba(255,255,255,.04);
    }
    @keyframes execPulse {
      0%{ box-shadow: 0 0 38px rgba(255,255,255,.08), 0 0 90px rgba(255,255,255,.03); }
      100%{ box-shadow: 0 0 46px rgba(255,255,255,.14), 0 0 120px rgba(255,255,255,.05); }
    }
    body.consent-locked .consent-banner.open{ animation: execPulse 1.2s ease-in-out infinite alternate; }
  
    .footer-links{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
      gap:0;
      text-align:center;
      padding:0 16px;
      line-height:1.9;
    }
    .footer-links a{
      display:inline-block;
      margin:4px 0;
      padding:0 10px;
      position:relative;
    }
    .footer-links a:not(:last-child)::after{
      content:"·";
      position:absolute;
      right:-2px;
      top:50%;
      transform:translateY(-52%);
      opacity:.38;
    }

    @media (max-width: 600px){
      .footer-links{ padding:0 12px; }
      .footer-links a{ padding:0 10px; }
      .footer-links a:not(:last-child)::after{ right:-3px; }
    }

  </style>
</head>

<body>
  <canvas id="canvas"></canvas>

  <div class="ui-layer top-bar">
    <div class="menu">
      <div class="menu-dot" id="menuToggle" role="button" tabindex="0" aria-label="Open menu" aria-expanded="false" aria-controls="menuDropdown"></div>

      <div class="menu-dropdown" id="menuDropdown" role="menu" aria-hidden="true">
        <a href="javascript:void(0)" class="locations-link" id="verticalsLink" role="menuitem" aria-haspopup="true" aria-expanded="false">VERTICALS</a>
        <a href="contact.html" id="contactLink" role="menuitem">CONTACT</a>
      </div>

      <div class="menu-dropdown-sub" id="verticalsSubmenu" aria-hidden="true">
        <div class="submenu-group">
          <div class="submenu-label">BIOTECH</div>
          <a class="submenu-link" href="https://www.microlabsx.com" target="_blank" rel="noopener">microlabsX</a>
          <div class="submenu-label">CREATIVE STUDIO</div>
          <a class="submenu-link" href="https://www.microstudiox.com" target="_blank" rel="noopener">microstudioX</a>
        </div>
      </div>
    </div>
  </div>

  <div class="ui-layer footer-bar">
    <div class="footer-links">
      <a href="terms.html" target="_blank" rel="noopener">Terms</a>
      <a href="privacy.html" target="_blank" rel="noopener">Privacy</a>
      <a href="cookies.html" target="_blank" rel="noopener">Cookies</a>
      <a href="javascript:void(0)" id="cookiePreferencesLink">Cookie Preferences</a>
      <a href="legal.html" target="_blank" rel="noopener">Legal</a>
    </div>

    <div class="copyright">
      © 2023-2025 MICRORETAILX LLC — ALL RIGHTS RESERVED<br/>
    </div>
  </div>

  <div class="consent-banner" id="consentBanner" aria-live="polite">
    <div class="consent-row">
      <div class="consent-text">
        We use strictly necessary technologies to operate this site and store your preferences locally in your browser.
        Optional categories (Analytics / Marketing) are currently not active and will only apply if such technologies are implemented in the future and you explicitly enable them.
        You can review or change your choice anytime via <a href="javascript:void(0)" id="cookiePreferencesInline">Cookie Preferences</a>.
      </div>
      <div class="consent-actions">
        <button class="consent-btn" id="consentReject">Reject</button>
        <button class="consent-btn" id="consentManage">Preferences</button>
        <button class="consent-btn primary" id="consentAccept">Accept</button>
      </div>
    </div>
  </div>

  <div class="consent-modal-backdrop" id="consentModalBackdrop" aria-hidden="true">
    <div class="consent-modal" role="dialog" aria-modal="true" aria-label="Cookie Preferences">
      <div class="consent-modal-header">
        <div class="consent-modal-title">COOKIE PREFERENCES</div>
        <button class="consent-modal-close" id="consentModalClose" aria-label="Close">×</button>
      </div>
      <div class="consent-modal-body">
        Choose which optional categories you would allow if such technologies are implemented in the future. Strictly necessary technologies are always enabled and do not require consent.
        <div class="consent-cats">
          <div class="consent-cat">
            <div>
              <strong>Necessary</strong>
              <p>Required for basic functionality, security and page delivery. Always on.</p>
            </div>
            <div class="toggle on locked" aria-label="Necessary cookies (always on)"></div>
          </div>

          <div class="consent-cat">
            <div>
              <strong>Analytics (future use)</strong>
              <p>
                No analytics technologies are currently active on this Website.
                If implemented in the future, they would only be loaded after your explicit consent.
              </p>
            </div>
            <div class="toggle" id="toggleAnalytics" role="switch" aria-checked="false" tabindex="0" aria-label="Analytics cookies"></div>
          </div>

          <div class="consent-cat">
            <div>
              <strong>Marketing (future use)</strong>
              <p>
                No marketing or tracking technologies are currently active.
                If implemented in the future, they would only be loaded after your explicit consent.
              </p>
            </div>
            <div class="toggle" id="toggleMarketing" role="switch" aria-checked="false" tabindex="0" aria-label="Marketing cookies"></div>
          </div>
        </div>
      </div>
      <div class="consent-modal-footer">
        <button class="consent-btn" id="consentSave">Save</button>
        <button class="consent-btn primary" id="consentAcceptAll">Accept All</button>
      </div>
    </div>
  </div>

  <script>
    "use strict";

    const menuToggle = document.getElementById("menuToggle");
    const menuDropdown = document.getElementById("menuDropdown");
    const verticalsLink = document.getElementById("verticalsLink");
    const verticalsSubmenu = document.getElementById("verticalsSubmenu");
    const contactLink = document.getElementById("contactLink");

    function positionVerticalsSubmenu() {
      if (!menuDropdown.classList.contains("open")) return;

      const d = menuDropdown.getBoundingClientRect();
      const v = verticalsLink.getBoundingClientRect();
      const top = Math.max(0, Math.round(v.top - d.top));
      verticalsSubmenu.style.top = `${top}px`;

      const openToLeft = (d.left + d.width / 2) > (window.innerWidth / 2);
      if (openToLeft) {
        verticalsSubmenu.style.right = "100%";
        verticalsSubmenu.style.left = "auto";
        verticalsSubmenu.style.marginRight = "14px";
        verticalsSubmenu.style.marginLeft = "0";
      } else {
        verticalsSubmenu.style.left = "100%";
        verticalsSubmenu.style.right = "auto";
        verticalsSubmenu.style.marginLeft = "14px";
        verticalsSubmenu.style.marginRight = "0";
      }
    }

    function setMenuOpen(open) {
      menuDropdown.classList.toggle("open", open);
      menuDropdown.setAttribute("aria-hidden", String(!open));
      menuToggle.classList.toggle("active", open);
      menuToggle.setAttribute("aria-expanded", String(open));
      menuToggle.setAttribute("aria-label", open ? "Close menu" : "Open menu");

      if (!open) {
        verticalsSubmenu.classList.remove("open");
        verticalsSubmenu.setAttribute("aria-hidden", "true");
        verticalsLink.setAttribute("aria-expanded", "false");
        menuToggle.classList.remove("shake", "double");
      }
    }

    function toggleMenu() { setMenuOpen(!menuDropdown.classList.contains("open")); }

    function setVerticalsOpen(open) {
      verticalsSubmenu.classList.toggle("open", open);
      verticalsSubmenu.setAttribute("aria-hidden", String(!open));
      verticalsLink.setAttribute("aria-expanded", String(open));
      if (open) positionVerticalsSubmenu();
    }

    menuToggle.addEventListener("click", (e) => { e.stopPropagation(); toggleMenu(); });
    menuToggle.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") { e.preventDefault(); toggleMenu(); }
      if (e.key === "Escape") { setMenuOpen(false); menuToggle.blur(); }
    });

    verticalsLink.addEventListener("click", (e) => {
      e.preventDefault(); e.stopPropagation();
      if (menuDropdown.classList.contains("open")) {
        menuToggle.classList.add("shake", "double");
        setTimeout(() => menuToggle.classList.remove("shake", "double"), 230);
      }
      setVerticalsOpen(!verticalsSubmenu.classList.contains("open"));
    });

    if (contactLink) contactLink.addEventListener("click", () => setMenuOpen(false));

    document.addEventListener("click", (e) => {
      if (!menuDropdown.contains(e.target) && !menuToggle.contains(e.target) && !verticalsSubmenu.contains(e.target)) {
        setMenuOpen(false);
      }
    });

    verticalsSubmenu.querySelectorAll("a").forEach(a => a.addEventListener("click", () => setMenuOpen(false)));
    window.addEventListener("resize", () => { if (verticalsSubmenu.classList.contains("open")) positionVerticalsSubmenu(); });

    const CONSENT_KEY = "mrxx_consent_v1";
    const consentBanner = document.getElementById("consentBanner");
    const consentModalBackdrop = document.getElementById("consentModalBackdrop");
    const cookiePreferencesLink = document.getElementById("cookiePreferencesLink");
    const cookiePreferencesInline = document.getElementById("cookiePreferencesInline");

    const consentReject = document.getElementById("consentReject");
    const consentManage = document.getElementById("consentManage");
    const consentAccept = document.getElementById("consentAccept");

    const consentModalClose = document.getElementById("consentModalClose");
    const consentSave = document.getElementById("consentSave");
    const consentAcceptAll = document.getElementById("consentAcceptAll");

    const toggleAnalytics = document.getElementById("toggleAnalytics");
    const toggleMarketing = document.getElementById("toggleMarketing");

    function lockSite() {
      document.body.classList.add("consent-locked");
      document.documentElement.style.overflow = "hidden";
    }
    function unlockSite() {
      document.body.classList.remove("consent-locked");
      document.documentElement.style.overflow = "";
    }
    function wakeSite() {
      unlockSite();
      void document.body.offsetHeight;
      document.body.classList.add("consent-waking");
      setTimeout(() => document.body.classList.remove("consent-waking"), 1250);
    }

    function persistConsent(state) {
      const payload = JSON.stringify(state);
      localStorage.setItem(CONSENT_KEY, payload);
    }

    function loadConsent() {
      const ls = localStorage.getItem(CONSENT_KEY);
      if (!ls) return null;
      try { return JSON.parse(ls); } catch (_) { return null; }
    }

    function generateAuditID() {
      return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
      );
    }
    function displayAuditID(id) {
      let el = document.getElementById("audit-display");
      if (!el) {
        el = document.createElement("div");
        el.id = "audit-display";
        el.style.cssText = "font-size:7px;opacity:0.25;margin-top:8px;letter-spacing:1px;text-transform:uppercase;color:white;";
        document.querySelector(".footer-bar").appendChild(el);
      }
      el.textContent = id ? `CONSENT-REF: ${String(id).toUpperCase()}` : "PREFERENCES: MINIMAL";
    }

    let analyticsLoaded = false;
    let marketingLoaded = false;

    function applyConsent(consent) {
      document.documentElement.dataset.analytics = consent.analytics ? "1" : "0";
      document.documentElement.dataset.marketing = consent.marketing ? "1" : "0";
      document.documentElement.dataset.consent = (consent.analytics || consent.marketing) ? "granted" : "denied";

      if (consent.analytics && !analyticsLoaded) {
        analyticsLoaded = true;
      }
      if (consent.marketing && !marketingLoaded) {
        marketingLoaded = true;
      }
    }

    function setToggle(el, on) {
      el.classList.toggle("on", !!on);
      el.setAttribute("aria-checked", String(!!on));
    }

    function openConsentPanel() {
      const current = loadConsent() || { necessary:true, analytics:false, marketing:false, ts:Date.now(), decision:"rejected", auditId:null };
      setToggle(toggleAnalytics, !!current.analytics);
      setToggle(toggleMarketing, !!current.marketing);
      consentModalBackdrop.classList.add("open");
      consentModalBackdrop.setAttribute("aria-hidden", "false");
    }

    function closeConsentPanel() {
      consentModalBackdrop.classList.remove("open");
      consentModalBackdrop.setAttribute("aria-hidden", "true");
    }

    function hideBanner() {
      consentBanner.classList.remove("open");
      wakeSite();
    }

    function setAllConsent(val) {
      const granted = !!val;
      const consent = {
        necessary: true,
        analytics: granted,
        marketing: granted,
        ts: Date.now(),
        decision: granted ? "accepted" : "rejected",
        auditId: granted ? generateAuditID() : null
      };

      persistConsent(consent);
      applyConsent(consent);
      displayAuditID(consent.auditId);

      hideBanner();
      closeConsentPanel();
    }

    function saveFromPanel() {
      const prev = loadConsent();
      const analytics = toggleAnalytics.classList.contains("on");
      const marketing = toggleMarketing.classList.contains("on");
      const optionalOn = analytics || marketing;

      const consent = {
        necessary: true,
        analytics,
        marketing,
        ts: Date.now(),
        decision: optionalOn ? "accepted" : "rejected",
        auditId: optionalOn ? (prev && prev.auditId ? prev.auditId : generateAuditID()) : null
      };

      persistConsent(consent);
      applyConsent(consent);
      displayAuditID(consent.auditId);

      hideBanner();
      closeConsentPanel();
    }

    function toggleSwitch(el) { setToggle(el, !el.classList.contains("on")); }
    function handleSwitchKey(el, e) {
      if (e.key === "Enter" || e.key === " ") { e.preventDefault(); toggleSwitch(el); }
    }

    cookiePreferencesLink.addEventListener("click", (e) => { e.preventDefault(); openConsentPanel(); });
    cookiePreferencesInline.addEventListener("click", (e) => { e.preventDefault(); openConsentPanel(); });

    consentManage.addEventListener("click", () => openConsentPanel());
    consentReject.addEventListener("click", () => setAllConsent(false));
    consentAccept.addEventListener("click", () => setAllConsent(true));

    consentModalClose.addEventListener("click", () => closeConsentPanel());
    consentSave.addEventListener("click", () => saveFromPanel());
    consentAcceptAll.addEventListener("click", () => setAllConsent(true));

    consentModalBackdrop.addEventListener("click", (e) => { if (e.target === consentModalBackdrop) closeConsentPanel(); });
    document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeConsentPanel(); });

    toggleAnalytics.addEventListener("click", () => toggleSwitch(toggleAnalytics));
    toggleMarketing.addEventListener("click", () => toggleSwitch(toggleMarketing));
    toggleAnalytics.addEventListener("keydown", (e) => handleSwitchKey(toggleAnalytics, e));
    toggleMarketing.addEventListener("keydown", (e) => handleSwitchKey(toggleMarketing, e));

    const existingConsent = loadConsent();
    if (existingConsent) {
      applyConsent(existingConsent);
      displayAuditID(existingConsent.auditId);
      wakeSite();
    } else {
      lockSite();
      consentBanner.classList.add("open");
    }


    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d", { alpha: false });

    let width = canvas.width = window.innerWidth;
    let height = canvas.height = window.innerHeight;

    const mouse = { x: -1000, y: -1000 };

    function setPointer(x, y) { mouse.x = x; mouse.y = y; }
    window.addEventListener("mousemove", e => setPointer(e.clientX, e.clientY), { passive: true });
    window.addEventListener("touchmove", e => {
      if (!e.touches || !e.touches[0]) return;
      setPointer(e.touches[0].clientX, e.touches[0].clientY);
    }, { passive: true });

    window.addEventListener("resize", () => {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
    });

    function isMobile() {
      return /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);
    }

    const MOBILE_MODE = isMobile();
  const UA = navigator.userAgent || "";
  const IS_IOS = /iPhone|iPad|iPod/i.test(UA) || (navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1);
  const IS_ANDROID = /Android/i.test(UA);
  let DOT_RGB = { r:0, g:234, b:255 };
  let PULSE_RGB = { r:255, g:35, b:90 };

    const REDUCED_MOTION = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

    let xPhaseT = 0;
    let xLastT = performance.now();

    const X_PHASE_IN = 2.8;
    const X_PHASE_HOLD = 1.15;
    const X_PHASE_OUT = 2.2;
    const X_PHASE_REST = 0.55;
    const X_CYCLE = X_PHASE_IN + X_PHASE_HOLD + X_PHASE_OUT + X_PHASE_REST;

    function xClamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
    function xEaseInOutCubic(t){ return t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2, 3)/2; }
    function xSmoothPulse(t){ return 0.5 - 0.5*Math.cos(Math.PI * xClamp(t,0,1)); }
    function xLerp(a,b,t){ return a + (b-a)*t; }
    function xBlendRGB(a,b,t){ return { r:Math.round(xLerp(a.r,b.r,t)), g:Math.round(xLerp(a.g,b.g,t)), b:Math.round(xLerp(a.b,b.b,t)) }; }

    function xDrawGlowDot(x, y, r, a, rgb){
      if (a <= 0) return;
      const c = rgb || DOT_RGB;
      const boost = IS_IOS ? 1.45 : 1.0; // iPhone needs more punch
      const aa = Math.min(1, a * boost);

      ctx.save();
      ctx.globalCompositeOperation = "lighter";
      const g = ctx.createRadialGradient(x, y, 0, x, y, r);
      g.addColorStop(0, `rgba(${c.r},${c.g},${c.b},${aa})`);
      g.addColorStop(0.35, `rgba(${c.r},${c.g},${c.b},${aa*0.35})`);
      g.addColorStop(1, "rgba(0,0,0,0)");
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(x, y, r, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    }


    function xDrawLines(alpha){
      ctx.save();
      ctx.strokeStyle = `rgba(0,234,255,${alpha})`;
      ctx.lineWidth = 1.7;
      ctx.beginPath();
      ctx.moveTo(0, 0); ctx.lineTo(width, height);
      ctx.moveTo(width, 0); ctx.lineTo(0, height);
      ctx.stroke();

      ctx.strokeStyle = `rgba(0,234,255,${alpha*0.52})`;
      ctx.lineWidth = 3.2;
      ctx.beginPath();
      ctx.moveTo(0, 0); ctx.lineTo(width, height);
      ctx.moveTo(width, 0); ctx.lineTo(0, height);
      ctx.stroke();
      ctx.restore();
    }

    function renderTermsX(now){
      function redPulseMix(t){
        const p = Math.pow(t, 1.6);
        const r = Math.round(234 * p + 0 * (1-p));
        const g = Math.round(20 * p + 234 * (1-p));
        const b = Math.round(40 * p + 255 * (1-p));
        return {r,g,b};
      }

      const dt = Math.min(0.05, (now - xLastT) / 1000);
      xLastT = now;
      xPhaseT = (xPhaseT + dt) % X_CYCLE;

      const cx = width / 2;
      const cy = height / 2;

      // Platform color profile
      DOT_RGB = IS_ANDROID ? { r: 40, g: 255, b: 150 } : { r: 0, g: 234, b: 255 };
      PULSE_RGB = IS_IOS ? { r: 255, g: 35, b: 90 } : (IS_ANDROID ? { r: 120, g: 255, b: 120 } : { r: 255, g: 35, b: 90 });

      const tIn = xClamp(xPhaseT / X_PHASE_IN, 0, 1);
      const tHold = xClamp((xPhaseT - X_PHASE_IN) / X_PHASE_HOLD, 0, 1);
      const tOut = xClamp((xPhaseT - X_PHASE_IN - X_PHASE_HOLD) / X_PHASE_OUT, 0, 1);

      const inActive = xPhaseT < X_PHASE_IN;
      const holdActive = xPhaseT >= X_PHASE_IN && xPhaseT < X_PHASE_IN + X_PHASE_HOLD;
      const outActive = xPhaseT >= X_PHASE_IN + X_PHASE_HOLD && xPhaseT < X_PHASE_IN + X_PHASE_HOLD + X_PHASE_OUT;

      const travelIn = xEaseInOutCubic(tIn);
      const travelOut = xEaseInOutCubic(tOut);

      const glowUp = xSmoothPulse(tHold);
      const fadeOut = 1 - xSmoothPulse(tOut);

      const baseA = 0.065;
      let lineA = baseA;
      if (inActive) lineA = baseA + 0.08 * xSmoothPulse(tIn);
      if (holdActive) lineA = baseA + 0.18 * glowUp;
      if (outActive) lineA = baseA + 0.14 * fadeOut;

      xDrawLines(lineA);

      const origins = [
        {x:0, y:0},
        {x:width, y:0},
        {x:0, y:height},
        {x:width, y:height}
      ];

      function posFromOrigin(o, progress){
        return { x: xLerp(o.x, cx, progress), y: xLerp(o.y, cy, progress) };
      }
      function posReturnToOrigin(o, progress){
        return { x: xLerp(cx, o.x, progress), y: xLerp(cy, o.y, progress) };
      }

      const headR = 70;
      const tailSteps = 14;
      const tailSpan = 0.10;

      function drawTrailTo(posFn, prog, alphaScale){
        for (let oi = 0; oi < origins.length; oi++){
          const o = origins[oi];
          const head = posFn(o, prog);
          const tint = (IS_IOS ? xClamp((prog - 0.70) / 0.30, 0, 1) : 0);
          const headRGB = (tint > 0 ? xBlendRGB(DOT_RGB, PULSE_RGB, tint) : DOT_RGB);


          for (let i = 0; i < tailSteps; i++){
            const k = i / tailSteps;
            const tt = xClamp(prog - k*tailSpan, 0, 1);
            const e = xEaseInOutCubic(tt);
            const p = posFn(o, e);
            const fade = (1 - k);
            xDrawGlowDot(p.x, p.y, 38 * fade, alphaScale * (0.08 * fade), DOT_RGB);
          }
          xDrawGlowDot(head.x, head.y, headR, alphaScale * 0.24, headRGB);
        }
      }

      if (inActive){
        drawTrailTo(posFromOrigin, travelIn, 1);
      } else if (holdActive){
        const centerBurst = 0.25 + 0.70 * glowUp;

        xDrawGlowDot(cx, cy, 120, centerBurst * 0.22, DOT_RGB);

        if (glowUp > 0.55){
          const pulseA = (IS_IOS ? 0.62 : 0.48) * centerBurst;
          xDrawGlowDot(cx, cy, 145 + 45*glowUp, pulseA, PULSE_RGB);
          xDrawGlowDot(cx, cy, 92 + 20*glowUp, pulseA * 0.55, PULSE_RGB);
        }

        xDrawGlowDot(cx, cy, 44, centerBurst * 0.68, DOT_RGB);
} else if (outActive){
        const a = Math.max(0, 0.9 * fadeOut);
        drawTrailTo(posReturnToOrigin, travelOut, a);
        const centerA = (0.10 + 0.20 * fadeOut);
        xDrawGlowDot(cx, cy, 78, centerA * 0.35);
      } else {
        xDrawGlowDot(cx, cy, 64, 0.02);
      }
    }


    const CORES = navigator.hardwareConcurrency || 4;
    const BASE_PARTICLES_DESKTOP = 1800;
    const BASE_PARTICLES_MOBILE = 250;

    const NUM_PARTICLES = REDUCED_MOTION
      ? Math.min(220, MOBILE_MODE ? 140 : 220)
      : (MOBILE_MODE ? BASE_PARTICLES_MOBILE : Math.min(BASE_PARTICLES_DESKTOP, CORES * 420));

    const MAX_CONNECTIONS = REDUCED_MOTION ? 2 : (MOBILE_MODE ? 4 : 10);
    const SPEED = REDUCED_MOTION ? 0.35 : 0.5;

    const xZoneMargin = 42;
    const X_SAT_THRESHOLD = MOBILE_MODE ? 30 : 80;

    const particles = [];
    const deathMarkers = [];

    function inXZone(x, y) {
      const d1 = Math.abs(y - (x * height / width));
      const d2 = Math.abs(y - (height - x * height / width));
      return (d1 < xZoneMargin || d2 < xZoneMargin);
    }

    function randomHex() {
      return "#" + Math.floor(Math.random() * 0xFFFFFF).toString(16).padStart(6, "0");
    }

    function createParticle() {
      let x, y;
      do {
        x = Math.random() * width;
        y = Math.random() * height;
      } while (inXZone(x, y));

      return {
        x, y,
        ox: x, oy: y,
        vx: (Math.random() - 0.5) * SPEED,
        vy: (Math.random() - 0.5) * SPEED,
        radius: 1.5,
        baseColor: "white",
        color: "white",
        inX: false,
        prevInX: false,
        hexCode: randomHex()
      };
    }

    for (let i = 0; i < NUM_PARTICLES; i++) particles.push(createParticle());

    function drawConnections() {
      const MAX_DIST = 100;
      const MAX_DIST2 = MAX_DIST * MAX_DIST;

      for (let i = 0; i < particles.length; i++) {
        let connections = 0;
        const pi = particles[i];
        for (let j = i + 1; j < particles.length && connections < MAX_CONNECTIONS; j++) {
          const pj = particles[j];
          const dx = pi.x - pj.x;
          const dy = pi.y - pj.y;
          const dist2 = dx * dx + dy * dy;
          if (dist2 < MAX_DIST2) {
            const dist = Math.sqrt(dist2);
            const mobileCleanAlpha = MOBILE_MODE ? 0.78 : 1;
            ctx.strokeStyle = `rgba(0,255,255,${(1 - dist / MAX_DIST) * mobileCleanAlpha})`;
            ctx.beginPath();
            ctx.moveTo(pi.x, pi.y);
            ctx.lineTo(pj.x, pj.y);
            ctx.stroke();
            connections++;
          }
        }
      }
    }

    function addDeathMarker(x, y) {
      deathMarkers.push({
        x, y,
        createdAt: performance.now(),
        angle: Math.random() * Math.PI * 2
      });
    }

    function drawDeathMarkers(now) {
      const LIFETIME = 650;
      for (let i = deathMarkers.length - 1; i >= 0; i--) {
        const m = deathMarkers[i];
        const age = now - m.createdAt;
        if (age > LIFETIME) {
          deathMarkers.splice(i, 1);
          continue;
        }
        const t = age / LIFETIME;
        const alpha = 1 - t;
        const rays = 4;
        const len = 2 + (8 * t);

        ctx.save();
        ctx.strokeStyle = `rgba(255,255,255,${alpha * 0.4})`;
        ctx.lineWidth = 0.8;

        for (let k = 0; k < rays; k++) {
          const a = m.angle + (Math.PI * 2 * k / rays);
          const x2 = m.x + Math.cos(a) * len;
          const y2 = m.y + Math.sin(a) * len;
          ctx.beginPath();
          ctx.moveTo(m.x, m.y);
          ctx.lineTo(x2, y2);
          ctx.stroke();
        }
        ctx.restore();
      }
    }

    function animate(now) {

      // --- iOS/iPad performance airbags ---
      if (typeof paused === "undefined") {
        window.paused = false;
        document.addEventListener("visibilitychange", () => { window.paused = document.hidden; }, { passive:true });
        window.TARGET_FPS_IOS = 30;
        window._lastFrameT = 0;
      }
      if (window.paused) { requestAnimationFrame(animate); return; }

      // Cap FPS only on iOS/iPad (prevents overheating on Safari)
      if (IS_IOS) {
        const minDt = 1000 / window.TARGET_FPS_IOS;
        if (now - window._lastFrameT < minDt) { requestAnimationFrame(animate); return; }
        window._lastFrameT = now;
      }


      if (MOBILE_MODE){
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, width, height);

        if (REDUCED_MOTION){
          ctx.save();
          ctx.strokeStyle = "rgba(0,234,255,0.12)";
          ctx.lineWidth = 2.2;
          ctx.beginPath();
          ctx.moveTo(0, 0); ctx.lineTo(width, height);
          ctx.moveTo(width, 0); ctx.lineTo(0, height);
          ctx.stroke();
          ctx.restore();
        } else {
          renderTermsX(now);
        }

        requestAnimationFrame(animate);
        return;
      }

      let inXCount = 0;

      for (const p of particles) {
        p.prevInX = p.inX;
        p.inX = inXZone(p.x, p.y);
        if (p.inX) inXCount++;
      }

      const centerX = width / 2;
      const centerY = height / 2;
      const saturated = inXCount >= X_SAT_THRESHOLD;

      ctx.fillStyle = "black";
      ctx.fillRect(0, 0, width, height);
      if (MOBILE_MODE && !REDUCED_MOTION){
        renderTermsX(now);
      } else {
        ctx.strokeStyle = "rgba(0,255,255,0.06)";
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(width, height);
        ctx.moveTo(width, 0);
        ctx.lineTo(0, height);
        ctx.stroke();
      }
drawConnections();
      if (!REDUCED_MOTION) drawDeathMarkers(now);

      for (const p of particles) {
        const dxm = p.x - mouse.x;
        const dym = p.y - mouse.y;
        const distm2 = dxm * dxm + dym * dym;
        if (distm2 < 10000 && distm2 > 0.0001) {
          const distm = Math.sqrt(distm2);
          const force = (100 - distm) * 0.007;
          p.vx += (dxm / distm) * force;
          p.vy += (dym / distm) * force;
        }

        if (p.inX && !p.prevInX && !REDUCED_MOTION) addDeathMarker(p.x, p.y);

        if (p.inX && saturated) {
          const dx = p.x - centerX;
          const dy = p.y - centerY;
          const d = Math.sqrt(dx * dx + dy * dy) || 1;
          p.vx += (dx / d) * 1.2;
          p.vy += (dy / d) * 1.2;
        }

        p.color = p.baseColor;

        if (p.inX && !REDUCED_MOTION) {
          p.vx += Math.sin(now * 0.1 + p.x) * 0.4;
          p.vy += Math.cos(now * 0.1 + p.y) * 0.4;
          p.radius = 3.3 + Math.sin(now * 0.05 + p.x + p.y) * 1.4;
          if (Math.random() < 0.4) p.hexCode = randomHex();
          ctx.font = "12px monospace";
          ctx.fillStyle = "white";
          ctx.fillText(p.hexCode, p.x + 10, p.y + 6);
        } else {
          if (p.prevInX) {
            p.radius = 1.5;
            p.hexCode = randomHex();
          }
        }

        p.vx += (p.ox - p.x) * 0.002;
        p.vy += (p.oy - p.y) * 0.002;

        if (!REDUCED_MOTION) {
          p.vx += (Math.random() - 0.5) * 0.05;
          p.vy += (Math.random() - 0.5) * 0.05;
        }

        p.x += p.vx;
        p.y += p.vy;

        p.vx *= 0.97;
        p.vy *= 0.97;

        if (p.x < 0 || p.x > width) p.vx *= -1;
        if (p.y < 0 || p.y > height) p.vy *= -1;

        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
        ctx.fill();
      }

      requestAnimationFrame(animate);
    }

    requestAnimationFrame(animate);
</script>
</body>
</html>
