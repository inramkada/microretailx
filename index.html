<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="referrer" content="no-referrer">
  <meta http-equiv="Permissions-Policy"
        content="geolocation=(), microphone=(), camera=(), payment=(), usb=()">
  <title>microretailX</title>

  <link rel="stylesheet" href="assets/app.css">
  <link rel="stylesheet" href="assets/legal-terms.css">

  <style>
    #canvas {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      display: block;
      pointer-events: none;
    }

    .ui-layer, .menu, .hero, .terms-wrap {
      position: relative;
      z-index: 2;
    }

    body {
      min-height: 100vh;
    }

    .footer-bar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 3;
    }

    .page-content {
      padding-bottom: 72px;
    }

    html.consent-locked,
    body.consent-locked {
      overflow: hidden !important;
      height: 100vh;
    }

    /* BLOQUEO TOTAL DE INTERACCIÓN (sin ocultar nada) */
    body.consent-locked * {
      pointer-events: none !important;
    }

    /* PERMITIR SOLO EL UI DE CONSENT */
    body.consent-locked #mrxConsentUI,
    body.consent-locked #mrxConsentUI * {
      pointer-events: all !important;
    }

    /* Velo visual (NO tapa la UI, solo oscurece) */
    #consentLock {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 1;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(3px);
      pointer-events: none;
    }

    html.consent-locked #consentLock,
    body.consent-locked #consentLock {
      display: block;
    }

    /* MRX CONSENT UI por encima de todo */
    #mrxConsentUI {
      z-index: 999;
    }

    /* Efecto visual en el canvas mientras locked */
    html.consent-locked #canvas {
      filter: grayscale(1) brightness(0.72) contrast(1.10);
      opacity: 0.85;
      transition: filter 1.1s ease, opacity 1.1s ease;
    }

    html.consent-decided #canvas {
      filter: none;
      opacity: 1;
    }
  </style>
</head>

<body>
  <canvas id="canvas"></canvas>
  <div id="consentLock" aria-hidden="true"></div>

  <!-- TOP BAR -->
  <div class="ui-layer top-bar">
    <div class="menu">
      <div class="menu-dot"
           id="menuToggle"
           role="button"
           tabindex="0"
           aria-label="Open menu"
           aria-expanded="false"
           aria-controls="menuDropdown"></div>

      <div class="menu-dropdown" id="menuDropdown" role="menu" aria-hidden="true">
        <a href="javascript:void(0)" class="locations-link" id="verticalsLink"
           role="menuitem" aria-haspopup="true" aria-expanded="false">VERTICALS</a>
        <a href="/contact.html" id="contactLink" role="menuitem">CONTACT</a>
      </div>

      <div class="menu-dropdown-sub" id="verticalsSubmenu" aria-hidden="true">
        <div class="submenu-group">
          <div class="submenu-label">BIOTECH</div>
          <a class="submenu-link" href="https://www.microlabsx.com"
             target="_blank" rel="noopener">microlabsX</a>
          <div class="submenu-label">CREATIVE STUDIO</div>
          <a class="submenu-link" href="https://www.microstudiox.com"
             target="_blank" rel="noopener">microstudioX</a>
        </div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="ui-layer footer-bar">
    <div class="footer-links">
      <a class="legal-link" data-legal-link="terms" href="legal/terms.html">Terms</a>
      <a class="legal-link" data-legal-link="privacy" href="legal/privacy.html">Privacy</a>
      <a class="legal-link" data-legal-link="cookies" href="legal/cookies.html">Cookies</a>
      <a class="legal-link" data-legal-link="prefs" href="#" id="cookiePreferencesLink">Cookie Preferences</a>
      <a class="legal-link" data-legal-link="legal" href="legal/legal.html">Legal</a>
    </div>

    <div class="copyright">
      © 2023-2026 MICRORETAILX LLC — ALL RIGHTS RESERVED
    </div>
  </div>

  <div class="privacy-toast" id="privacyToast" role="status" aria-live="polite"></div>

  <script src="assets/legal-terms.js" defer></script>
  <script src="assets/app.js" defer></script>

  <script type="module">
    import { applyInitialLock, onDecided, isDecided } from './assets/consent-core.js';
    import { maybeMountConsentUI } from './assets/consent-ui.js';
    import { init as initParticles } from './assets/fondo-particulas-inicio.js';

    applyInitialLock();

    if (!isDecided()) {
      maybeMountConsentUI();
    }

    const destroyParticles = initParticles('canvas');

    onDecided((consent) => {
      console.log('[MRX] Consent decided:', consent);
    });

    const prefLink = document.getElementById('cookiePreferencesLink');
    if (prefLink) {
      prefLink.addEventListener('click', (e) => {
        e.preventDefault();
        import('./assets/consent-ui.js').then(({ mountConsentUI }) => {
          mountConsentUI();
        });
      });
    }

    window.addEventListener('beforeunload', () => {
      if (destroyParticles) destroyParticles();
    });
  </script>
</body>
</html>
